{% load static %} 
<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{% block title %}Conecta Pilar{% endblock %}</title>
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
        <link rel="stylesheet" href="{% static 'css/style.css' %}?v=27">
    </head>

<body class="{% if user.is_authenticated and user.profile.modo_alto_contraste %}high-contrast{% endif %}">

    <div class="accessibility-fab">
        <button id="toggleAccess" class="btn btn-primary rounded-circle shadow-lg" title="Acessibilidade" style="display: flex; align-items: center; justify-content: center; padding: 0;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32" height="32" fill="currentColor" style="color: #000;">
                <path d="M12 2c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm9 7h-6v13h-2v-6h-2v6H9V9H3V7h18v2z"/>
            </svg>
        </button>
        
        <div class="access-menu" id="accessMenu">
            <button onclick="changeFontSize(1)" class="btn btn-sm btn-light w-100 mb-2">A+ Aumentar Fonte</button>
            <button onclick="changeFontSize(-1)" class="btn btn-sm btn-light w-100 mb-2">A- Diminuir Fonte</button>
            <button onclick="toggleHighContrast()" class="btn btn-sm btn-warning w-100">Alto Contraste</button>
        </div>
    </div>

    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="{% url 'home' %}">
                <img src="{% static 'images/logo.png' %}" alt="Logo" height="30" class="d-inline-block align-text-top">
                Conecta Pilar
            </a>
    
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon" style="filter: invert(1);"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
                    
                    <li class="nav-item">
                        <a class="nav-link {% if request.path == '/' %}active{% endif %}" href="{% url 'index' %}">
                            Início
                        </a>
                    </li>
            
                    {% if user.is_authenticated %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'aluno' in request.path or 'professor' in request.path %}active{% endif %}" 
                               href="{% url 'home' %}"> Minha Área
                            </a>
                        </li>
                        
                        {% if user.profile.role == 'aluno' %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'agendamentos' in request.path %}active{% endif %}" href="{% url 'agendamentos' %}">
                                Agendamentos
                            </a>
                        </li>
                        {% endif %}
            
                        <li class="nav-item">
                            <a class="nav-link {% if 'perfil' in request.path %}active{% endif %}" href="{% url 'perfil' %}">
                                Perfil
                            </a>
                        </li>
                    {% endif %}
                </ul>
            
                <ul class="navbar-nav">
                    {% if user.is_authenticated %}
                         <li class="nav-item dropdown">
                              <a class="nav-link dropdown-toggle d-flex align-items-center gap-2" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                  {% if user.profile.foto %}
                                      <img src="{{ user.profile.foto.url }}" class="rounded-circle border border-light" width="35" height="35" style="object-fit: cover;">
                                  {% else %}
                                      <div class="rounded-circle bg-light text-dark d-flex justify-content-center align-items-center fw-bold" style="width: 35px; height: 35px;">
                                          {{ user.username|slice:":1"|upper }}
                                      </div>
                                  {% endif %}
                                  <span class="fw-bold text-white">{{ user.first_name|default:user.username }}</span>
                              </a>
                              
                              <ul class="dropdown-menu dropdown-menu-end glass-dropdown" aria-labelledby="userDropdown">
                                  <li><a class="dropdown-item" href="{% url 'perfil' %}"> Meu Perfil</a></li>
                                  <li><a class="dropdown-item" href="{% url 'configuracoes' %}"> Configurações</a></li>
                                  <li><hr class="dropdown-divider bg-light"></li>
                                  <li><a class="dropdown-item text-danger fw-bold" href="{% url 'logout' %}">Sair</a></li>
                              </ul>
                          </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="btn btn-primary px-4" href="{% url 'login' %}">Entrar</a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <main class="container mt-4 mb-5 pt-5"> 
        {% if messages %}
            {% for message in messages %}
            <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %} alert-dismissible fade show mt-4" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
        {% endif %}

        {% block content %}
        {% endblock %}
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const fab = document.getElementById('toggleAccess');
            const menu = document.getElementById('accessMenu');
            
            if(fab && menu) {
                fab.addEventListener('click', () => {
                    menu.classList.toggle('show');
                });
            }
        });

        let currentFontSize = 100;
        function changeFontSize(step) {
            currentFontSize += step * 10;
            if(currentFontSize < 100) currentFontSize = 100; 
            if(currentFontSize > 200) currentFontSize = 200; 
            document.body.style.fontSize = currentFontSize + '%';
        }

        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
        }
    </script>

</body>
</html>